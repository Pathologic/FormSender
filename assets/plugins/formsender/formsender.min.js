!function(){class e{constructor(e,s,t){this.event=new CustomEvent(s,{cancelable:!0,bubbles:!0,detail:t}),e.dispatchEvent(this.event),window.jQuery&&(this.$event=$.Event(s),jQuery(e).trigger(this.$event,t))}isPrevented(){return!!this.event.defaultPrevented||!(!window.jQuery||!(this.$event.isDefaultPrevented()||void 0!==this.$event.result&&!1===this.$event.result))}}class s{constructor(e,s){this.info=alert,this.error=alert,"function"==typeof e&&(this.info=e),"function"==typeof s&&(this.error=s)}message(e,s){const t=this;if("object"==typeof s&&s.constructor===Array)s.length>0&&s.forEach((s=>t.message(e,s)));else{("error"===e?this.error:this.info).call(window,s)}}}window.FormSender=class{options={formWrapper:".form-wrapper",submitBtn:"[type=submit]",errorClass:"has-error",errorMessageElement:"div",errorMessageClass:"help-block",successMessageText:"The form has been sent successfully",errorMessageText:"Failed to send",url:"/forms"};messager=new s(alert,alert);constructor(e={}){if("object"!=typeof e)throw new Error("Wrong options");"object"==typeof e.messager&&e.messager.constructor===s&&(this.messager=e.messager,delete e.messager),Object.assign(this.options,e),this.init()}init(){const e=document.querySelectorAll(this.options.formWrapper),s=this;e.forEach((e=>{const t=e.querySelector("form");t&&t.addEventListener("submit",s.submit.bind(s),!1)}))}submit(e){e.preventDefault();const s=this,t=e.target,r=new FormData(t),o=t.closest(this.options.formWrapper);if(this.invokeEvent(t,"fs:before",{wrapper:o,data:r}).isPrevented())return;this.beforeSubmit(t);const n=this.messager;this.request(r,(function(e){if(s.afterSubmit(t),e.status){s.invokeEvent(t,"fs:success",{wrapper:o,data:r,response:e}).isPrevented()||(void 0!==e.redirect?window.location.href=e.redirect:void 0!==e.output?o.innerHTML=e.output:void 0!==e.messages&&e.messages.length>0?n.message("info",e.messages):(t.reset(),s.beforeSubmit(),s.afterSubmit(),n.message("info",s.options.successMessageText)))}else{s.invokeEvent(t,"fs:fail",{wrapper:o,data:r,response:e}).isPrevented()||s.processErrors(e,t)}s.invokeEvent(t,"fs:after",{wrapper:o,data:r,response:e})}),(function(e){s.afterSubmit(t),n.message("error",s.options.errorMessageText),s.invokeEvent(t,"fs:error",{wrapper:o,form:t,data:r,error:e})}))}beforeSubmit(e){const s=e.getElementsByClassName(this.options.errorMessageClass);Array.from(s).forEach((e=>e.remove()));const t=this.options.errorClass,r=e.getElementsByClassName(t);Array.from(r).forEach((e=>e.classList.remove(t)));const o=e.querySelector(this.options.submitBtn);o&&o.setAttribute("disabled","")}afterSubmit(e){const s=e.querySelector(this.options.submitBtn);s&&s.removeAttribute("disabled")}request(e,s,t){fetch(new Request(this.options.url,{method:"post",credentials:"same-origin",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:e})).then((e=>{if(!e.ok)throw new Error;return e.json()})).then(s).catch(t)}processErrors(e,s){const t=this;if(Object.keys(e.errors??[]).length>0){s.querySelectorAll("[data-field]").forEach((s=>{const r=s.getAttribute("data-field");if(void 0!==e.errors[r]){s.classList.add(t.options.errorClass);const o=e.errors[r];for(const e in o){const r=document.createElement(t.options.errorMessageElement);r.className=t.options.errorMessageClass,r.textContent=o[e],s.appendChild(r)}}}))}void 0!==e.messages&&e.messages.length>0&&this.messager.message("error",e.messages)}invokeEvent(s,t,r){return new e(s,t,r)}},window.FormSenderMessager=s}();
